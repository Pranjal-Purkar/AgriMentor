<div class="chat-container">
  <!-- Sidebar - Chat Rooms -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2>Messages</h2>
    </div>

    <div class="room-list">
      <div
        *ngFor="let room of chatRooms"
        class="room-item"
        [class.active]="selectedRoom?.id === room.id"
        (click)="selectRoom(room)"
      >
        <div class="avatar bg-amber-600">
          {{ getOtherParticipant(room).firstName?.charAt(0) || 'U' }}
        </div>
        <div class="room-info">
          <h3>
            {{ getOtherParticipant(room).firstName }} {{ getOtherParticipant(room).lastName }}
          </h3>
          <p class="room-topic" *ngIf="room.consultation?.topic">
            {{ room.consultation?.topic }}
          </p>
        </div>
        <div class="room-meta">
          <span class="timestamp" *ngIf="room.lastMessageAt">
            {{ formatTime(room.lastMessageAt) }}
          </span>
          <span class="unread-badge" *ngIf="(room.unreadCount || 0) > 0">
            {{ room.unreadCount }}
          </span>
        </div>
      </div>

      <div *ngIf="chatRooms.length === 0 && !loading" class="no-rooms">
        No chat conversations yet.
      </div>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="chat-main" *ngIf="selectedRoom; else noSelection">
    <div class="chat-header">
      <div class="header-info">
        <h3>
          {{ getOtherParticipant(selectedRoom).firstName }}
          {{ getOtherParticipant(selectedRoom).lastName }}
        </h3>
        <span class="status">Online</span>
      </div>
    </div>

    <div class="messages-container" #messageContainer>
      <div
        *ngFor="let msg of messages"
        class="message-bubble"
        [class.sent]="isSentByMe(msg)"
        [class.received]="!isSentByMe(msg)"
      >
        <div class="message-content">
          {{ msg.content }}
          <span class="message-time">
            {{ formatTime(msg.sentAt || '') }}
            <span *ngIf="isSentByMe(msg)" class="ticks">
              {{ msg.status === 'READ' ? '✓✓' : '✓' }}
            </span>
          </span>
        </div>
      </div>
    </div>

    <div class="chat-input">
      <input
        type="text"
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"
        placeholder="Type a message..."
      />
      <button (click)="sendMessage()" [disabled]="!newMessage.trim()">Send</button>
    </div>
  </div>

  <ng-template #noSelection>
    <div class="no-selection">
      <div class="placeholder-content">
        <h3>Select a conversation</h3>
        <p>Choose a chat from the left to start messaging</p>
      </div>
    </div>
  </ng-template>
</div>
