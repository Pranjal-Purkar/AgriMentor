<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 animate-fadeIn">
  <h3 class="text-xl font-bold text-gray-900 mb-2">
    {{ existingFeedback ? 'Edit Feedback' : 'Rate Your Experience' }}
  </h3>
  <p class="text-gray-500 text-sm mb-6">
    Share your experience with this consultation. Your feedback helps us improve.
  </p>

  <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Communication Rating -->
    <div class="space-y-2">
      <label class="block text-sm font-semibold text-gray-700">Communication</label>
      <div class="flex items-center gap-1">
        <button
          type="button"
          *ngFor="let star of stars"
          (click)="setRating('ratingCommunication', star)"
          class="focus:outline-none transition-transform hover:scale-110"
          [ngClass]="{
            'text-yellow-400': star <= feedbackForm.get('ratingCommunication')?.value,
            'text-gray-300': star > feedbackForm.get('ratingCommunication')?.value
          }"
        >
          <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24">
            <path
              d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
            />
          </svg>
        </button>
      </div>
      <div
        *ngIf="
          feedbackForm.get('ratingCommunication')?.touched &&
          feedbackForm.get('ratingCommunication')?.invalid
        "
        class="text-red-500 text-xs mt-1"
      >
        Please rate communication.
      </div>
    </div>

    <!-- Expertise Rating -->
    <div class="space-y-2">
      <label class="block text-sm font-semibold text-gray-700">Expertise</label>
      <div class="flex items-center gap-1">
        <button
          type="button"
          *ngFor="let star of stars"
          (click)="setRating('ratingExpertise', star)"
          class="focus:outline-none transition-transform hover:scale-110"
          [ngClass]="{
            'text-yellow-400': star <= feedbackForm.get('ratingExpertise')?.value,
            'text-gray-300': star > feedbackForm.get('ratingExpertise')?.value
          }"
        >
          <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24">
            <path
              d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
            />
          </svg>
        </button>
      </div>
      <div
        *ngIf="
          feedbackForm.get('ratingExpertise')?.touched &&
          feedbackForm.get('ratingExpertise')?.invalid
        "
        class="text-red-500 text-xs mt-1"
      >
        Please rate expertise.
      </div>
    </div>

    <!-- Timeliness Rating -->
    <div class="space-y-2">
      <label class="block text-sm font-semibold text-gray-700">Timeliness</label>
      <div class="flex items-center gap-1">
        <button
          type="button"
          *ngFor="let star of stars"
          (click)="setRating('ratingTimeliness', star)"
          class="focus:outline-none transition-transform hover:scale-110"
          [ngClass]="{
            'text-yellow-400': star <= feedbackForm.get('ratingTimeliness')?.value,
            'text-gray-300': star > feedbackForm.get('ratingTimeliness')?.value
          }"
        >
          <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24">
            <path
              d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
            />
          </svg>
        </button>
      </div>
      <div
        *ngIf="
          feedbackForm.get('ratingTimeliness')?.touched &&
          feedbackForm.get('ratingTimeliness')?.invalid
        "
        class="text-red-500 text-xs mt-1"
      >
        Please rate timeliness.
      </div>
    </div>

    <!-- Feedback Text -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-1">Details</label>
      <textarea
        formControlName="feedbackText"
        rows="4"
        class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all resize-none"
        placeholder="What did you like? What could be improved?"
      ></textarea>
      <div class="flex justify-between items-center mt-1">
        <div
          *ngIf="
            feedbackForm.get('feedbackText')?.touched && feedbackForm.get('feedbackText')?.invalid
          "
          class="text-red-500 text-xs"
        >
          Must be between 10 and 1000 characters.
        </div>
        <div class="text-xs text-gray-400 ml-auto">
          {{ feedbackForm.get('feedbackText')?.value?.length || 0 }} / 1000
        </div>
      </div>
    </div>

    <!-- Anonymous Toggle -->
    <div class="flex items-center gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100">
      <input
        type="checkbox"
        id="isAnonymous"
        formControlName="isAnonymous"
        class="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300"
      />
      <label for="isAnonymous" class="text-sm font-medium text-gray-700 select-none cursor-pointer">
        Submit anonymously (Hide my name)
      </label>
    </div>

    <!-- Actions -->
    <div class="flex gap-3 pt-2">
      <button
        type="button"
        (click)="onCancel()"
        class="flex-1 px-4 py-2.5 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-colors"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="isLoading || feedbackForm.invalid"
        class="flex-1 px-4 py-2.5 bg-emerald-600 text-white font-semibold rounded-xl hover:bg-emerald-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2 shadow-lg shadow-emerald-200"
      >
        <span
          *ngIf="isLoading"
          class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"
        ></span>
        {{ existingFeedback ? 'Update Feedback' : 'Submit Feedback' }}
      </button>
    </div>
  </form>
</div>
