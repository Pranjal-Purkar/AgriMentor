<div
  class="min-h-screen bg-gradient-to-b from-blue-50 to-gray-100 flex flex-col items-center justify-center px-4 py-10"
>
  <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 w-full max-w-3xl">
    <!-- Header -->
    <div class="flex flex-col items-center mb-8">
      <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">Register as Consultant</h2>
      <p class="text-gray-500 text-center text-sm sm:text-base">
        Join our network of agricultural experts
      </p>
    </div>

    <!-- Stepper Progress -->
    <div class="mb-8">
      <div class="flex items-center justify-between relative">
        <!-- Progress Line -->
        <div class="absolute top-5 left-0 right-0 h-1 bg-gray-200 -z-10"></div>
        <div
          class="absolute top-5 left-0 h-1 bg-blue-600 transition-all duration-500 -z-10"
          [style.width]="getProgressWidth()"
        ></div>

        <!-- Step 1 -->
        <div class="flex flex-col items-center flex-1">
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300"
            [ngClass]="currentStep >= 1 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500'"
          >
            @if (currentStep > 1) {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="3"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
            } @else { 1 }
          </div>
          <span class="text-xs sm:text-sm mt-2 font-medium text-gray-700 text-center"
            >Basic Info</span
          >
        </div>

        <!-- Step 2 -->
        <div class="flex flex-col items-center flex-1">
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300"
            [ngClass]="currentStep >= 2 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500'"
          >
            @if (currentStep > 2) {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="3"
                d="M5 13l4 4L19 7"
              ></path>
            </svg>
            } @else { 2 }
          </div>
          <span class="text-xs sm:text-sm mt-2 font-medium text-gray-700 text-center">Address</span>
        </div>

        <!-- Step 3 -->
        <div class="flex flex-col items-center flex-1">
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300"
            [ngClass]="currentStep >= 3 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500'"
          >
            3
          </div>
          <span class="text-xs sm:text-sm mt-2 font-medium text-gray-700 text-center"
            >Verify OTP</span
          >
        </div>
      </div>
    </div>

    <!-- Form Steps -->
    <form [formGroup]="consultantForm" (ngSubmit)="onSubmit()">
      <!-- Step 1: Basic Information -->
      @if (currentStep === 1) {
      <div class="space-y-4 animate-fade-in">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Basic Information</h3>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <!-- First Name -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
            <input
              formControlName="firstName"
              type="text"
              placeholder="John"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['firstName'].touched && f['firstName'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter at least 3 characters.</p>
            }
          </div>

          <!-- Last Name -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
            <input
              formControlName="lastName"
              type="text"
              placeholder="Smith"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['lastName'].touched && f['lastName'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter at least 3 characters.</p>
            }
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
            <input
              formControlName="email"
              type="email"
              placeholder="john@example.com"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['email'].touched && f['email'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter a valid email.</p>
            }
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
            <input
              formControlName="phone"
              type="tel"
              placeholder="1234567890"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['phone'].touched && f['phone'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter a 10-digit number.</p>
            }
          </div>

          <!-- Experience Years -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Years of Experience *</label
            >
            <input
              formControlName="experienceYears"
              type="number"
              placeholder="10"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['experienceYears'].touched && f['experienceYears'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter valid years.</p>
            }
          </div>

          <!-- Qualification -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Highest Qualification *</label
            >
            <select
              formControlName="qualifications"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            >
              <option value="" disabled>Select qualification</option>
              @for (q of qualifications; track q) {
              <option [value]="q">{{ q }}</option>
              }
            </select>
            @if (f['qualifications'].touched && f['qualifications'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Please select one.</p>
            }
          </div>
          <!-- Area of Expertise -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Area of Expertise *</label>
            <input
              formControlName="experienceArea"
              type="text"
              placeholder="e.g., Crop Management, Soil Science"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['experienceArea'].touched && f['experienceArea'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter your expertise.</p>
            }
          </div>
          <!-- specialization -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Specialization *</label>
            <input
              formControlName="specialization"
              type="text"
              placeholder="e.g., Crop Management, Soil Science"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['specialization'].touched && f['specialization'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter Your Specialization.</p>
            }
        </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">About You *</label>
          <textarea
            formControlName="bio"
            placeholder="about you"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
          ></textarea>
          @if (f['bio'].touched && f['bio'].invalid) {
          <p class="text-red-600 text-xs sm:text-sm mt-1">Enter your About You.</p>
          }
        </div>

        <!-- Verification Document -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Verification Documents *</label
          >
          <label
            class="flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg py-6 sm:py-8 text-gray-500 cursor-pointer hover:border-blue-600 transition"
          >
            <input type="file" class="hidden" (change)="onFileSelected($event)" />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-8 h-8 mb-2 text-blue-600"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M12 12V4m0 8l-4 4m4-4l4 4"
              />
            </svg>
            <span class="text-xs sm:text-sm text-center px-2"
              >Upload certificates (PDF, JPG, PNG up to 10MB)</span
            >
          </label>
          @if (f['verificationDocument'].touched && f['verificationDocument'].invalid) {
          <p class="text-red-600 text-xs sm:text-sm mt-1">Upload required.</p>
          }
        </div>

        <!-- Password Fields -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
            <input
              formControlName="password"
              type="password"
              placeholder="••••••••"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['password'].touched && f['password'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Min 6 characters.</p>
            }
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password *</label>
            <input
              formControlName="confirmPassword"
              type="password"
              placeholder="••••••••"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (consultantForm.hasError('passwordMismatch') && f['confirmPassword'].touched) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Passwords don't match.</p>
            }
          </div>
        </div>
      </div>
      }

      <!-- Step 2: Address Details -->
      @if (currentStep === 2) {
      <div class="space-y-4 animate-fade-in">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Address Details</h3>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <!-- Street Address -->
          <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Street Address *</label>
            <input
              formControlName="street"
              type="text"
              placeholder="123 Main Street"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['street'].touched && f['street'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Street address is required.</p>
            }
          </div>

          <!-- City -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">City *</label>
            <input
              formControlName="city"
              type="text"
              placeholder="Mumbai"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['city'].touched && f['city'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">City is required.</p>
            }
          </div>

          <!-- State -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">State *</label>
            <input
              formControlName="state"
              type="text"
              placeholder="Maharashtra"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['state'].touched && f['state'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">State is required.</p>
            }
          </div>

          <!-- Postal Code -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Postal Code *</label>
            <input
              formControlName="postalCode"
              type="text"
              placeholder="400001"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['postalCode'].touched && f['postalCode'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Enter valid postal code.</p>
            }
          </div>

          <!-- Country -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Country *</label>
            <input
              formControlName="country"
              type="text"
              placeholder="India"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
            />
            @if (f['country'].touched && f['country'].invalid) {
            <p class="text-red-600 text-xs sm:text-sm mt-1">Country is required.</p>
            }
          </div>
        </div>

        <!-- Terms Checkbox -->
        <div class="flex items-start space-x-2 pt-2">
          <input
            id="terms"
            type="checkbox"
            formControlName="terms"
            class="w-4 h-4 mt-1 text-blue-700 border-gray-300 rounded focus:ring-blue-600"
          />
          <label for="terms" class="text-xs sm:text-sm text-gray-600">
            I agree to the Terms of Service, Privacy Policy, and Code of Conduct for Consultants.
          </label>
        </div>
        @if (f['terms'].touched && f['terms'].invalid) {
        <p class="text-red-600 text-xs sm:text-sm">You must agree to continue.</p>
        }
      </div>
      }

      <!-- Step 3: OTP Verification -->
      @if (currentStep === 3) {
      <div class="space-y-6 animate-fade-in">
        <div class="text-center">
          <div
            class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-8 h-8 text-blue-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-800 mb-2">Verify Your Email</h3>
          <p class="text-sm text-gray-600 mb-6">
            We've sent a 6-digit code to
            <span class="font-semibold text-blue-600">{{ f['email'].value }}</span>
          </p>
        </div>

        <!-- OTP Input -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2 text-center"
            >Enter OTP Code</label
          >
          <div class="flex justify-center gap-2 sm:gap-3">
            @for (digit of [0,1,2,3,4,5]; track digit) {
            <input
              type="text"
              maxlength="1"
              (input)="onOtpInput($event, digit)"
              (keydown)="onOtpKeydown($event, digit)"
              #otpInput
              class="w-10 h-10 sm:w-12 sm:h-12 text-center text-lg font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-blue-600 focus:outline-none"
            />
            }
          </div>
          @if (otpError) {
          <p class="text-red-600 text-xs sm:text-sm mt-2 text-center">{{ otpError }}</p>
          }
        </div>

        <!-- Resend OTP -->
        <div class="text-center">
          <p class="text-xs sm:text-sm text-gray-600">
            Didn't receive the code?
            <button
              type="button"
              (click)="resendOtp()"
              class="text-blue-600 hover:underline font-medium ml-1"
            >
              Resend OTP
            </button>
          </p>
        </div>
      </div>
      }

      <!-- Navigation Buttons -->
      <div class="flex justify-between mt-8 gap-4">
        <button
          type="button"
          (click)="previousStep()"
          [disabled]="currentStep === 1"
          class="px-4 sm:px-6 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition"
        >
          Previous
        </button>

        @if (currentStep < 3) {
        <button
          type="button"
          (click)="nextStep()"
          class="px-4 sm:px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition"
        >
          Next
        </button>
        } @else {
        <button
          type="submit"
          class="px-4 sm:px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 transition"
        >
          Submit Application
        </button>
        }
      </div>
    </form>

    <p class="text-center text-xs sm:text-sm text-gray-600 mt-6">
      Already have an account?
      <button class="text-blue-700 hover:underline font-medium cursor-pointer" routerLink="/login">
        Sign in here
      </button>
    </p>
  </div>
</div>
